<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{{ SERVER_NAME }}</title>
      <link rel="icon" type="image/webp" href="{{ url_for('static', filename='favicon.webp', v=favicon_timestamp) }}" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
    {% include "_bottom_nav.html" %}
    <div class="container medialists-container">
        <h1>Media Lists</h1>
        <label for="list-select" style="font-weight:bold; margin-bottom:0.7em; display:block;">Select Library:</label>
        <select id="list-select" style="margin-bottom:1.5em; max-width: 350px;">
          {% for lib_name in library_poster_groups.keys() %}
            <option value="plex-{{ loop.index0 }}">Plex - {{ lib_name }}</option>
          {% endfor %}
          {% if abs_book_groups %}
            <option value="abs">Audiobookshelf</option>
          {% endif %}
        </select>
        {% for lib_name, poster_groups in library_poster_groups.items() %}
        <div class="medialist-section" id="plex-{{ loop.index0 }}" style="display:none;">
          <div style="display: flex; align-items: center; gap: 1em; margin-bottom: 0.5em;">
            <img src="/static/plex.webp" alt="Plex Logo" style="height: 32px; display: block;" />
            <span class="service-libraries-label">Plex - {{ lib_name }}</span>
          </div>
          {% set all_letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'|list + ['0-9', 'Other'] %}
          {% for letter in all_letters %}
              {% set posters = poster_groups.get(letter, []) %}
              {% if posters %}
                  <details style="margin-bottom: 0.7em;">
                      <summary class="collapsible-heading">{{ letter }}</summary>
                      <ul>
                          {% for poster in posters %}
                              <li>
                                  {% if poster.poster %}
                                    <img src="{{ poster.poster }}" alt="{{ poster.title }} poster" style="width: 32px; vertical-align: middle; border-radius: 4px; margin-right: 0.5em;" />
                                  {% endif %}
                                  <span style="font-weight: bold;">{{ poster.title }}</span>
                                  <span style="font-size: 0.9em;">
                                    {% if poster.imdb %}
                                      <a href="https://www.imdb.com/title/{{ poster.imdb }}" target="_blank">IMDB</a>
                                    {% endif %}
                                  </span>
                              </li>
                          {% endfor %}
                      </ul>
                  </details>
              {% endif %}
          {% endfor %}
        </div>
        {% endfor %}
        {% if abs_book_groups %}
        <div class="medialist-section" id="abs" style="display:none; margin-top: 2em;">
            <div style="display: flex; align-items: center; gap: 1em; margin-bottom: 0.5em;">
              <img src="/static/abs.webp" alt="ABS Logo" style="height: 32px; display: block;" />
              <span class="service-libraries-label">Audiobookshelf</span>
            </div>
            {% set all_letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'|list + ['0-9', 'Other'] %}
            {% for letter in all_letters %}
              {% set books = abs_book_groups.get(letter, []) %}
              {% if books %}
                <details style="margin-bottom: 0.7em;">
                  <summary class="collapsible-heading">{{ letter }}</summary>
                  <ul>
                    {% for book in books %}
                      <li>
                        <img src="{{ book.cover if book.cover else url_for('static', filename=logo_filename) }}"
                             alt="{{ book.title }} cover"
                             style="width: 32px; vertical-align: middle; border-radius: 4px; margin-right: 0.5em;"
                             onerror="this.onerror=null;this.src='{{ url_for('static', filename=logo_filename) }}';" />
                        <span style="font-weight: bold;">{{ book.title }}</span>
                        {% if book.author %}
                          <span style="font-size: 0.9em; color: #aaa;">by {{ book.author }}</span>
                        {% endif %}
                        <span style="font-size: 0.9em; margin-left: 0.5em;">
                          <a href="https://www.goodreads.com/search?q={{ (book.title ~ ' ' ~ (book.author or '')) | urlencode }}" target="_blank">Goodreads</a>
                        </span>
                      </li>
                    {% endfor %}
                  </ul>
                </details>
              {% endif %}
            {% endfor %}
        </div>
        {% endif %}
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
          const select = document.getElementById("list-select");
          const sections = document.querySelectorAll(".medialist-section");
          function showSection(id) {
            sections.forEach(sec => sec.style.display = "none");
            const el = document.getElementById(id);
            if (el) el.style.display = "block";
          }
          // Show the first section by default
          if (select.options.length > 0) {
            showSection(select.options[0].value);
            select.value = select.options[0].value;
          }
          select.addEventListener("change", function () {
            showSection(this.value);
          });
        });
      </script>
      
</body>
</html>
